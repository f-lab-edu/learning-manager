@startuml

title 3.2 [P1] Session Update

actor "User (Manager)" as User
participant "CredentialValidator" as Validator
participant "SessionController" as Controller
participant "SessionService" as AppService
participant "Session" as SessionDomain
participant "Clock" as Clock
participant "CourseRepository" as Repository

User -> Controller: Update Session
activate Validator
activate Controller
Validator --> User: 401 Unauthorized
Validator --> User: 403 Forbidden
deactivate Validator

Controller -> AppService: updateSession
activate AppService
alt Session Constraint Violation
    AppService --> Controller: ErrorResponse (400 Bad Request)
    deactivate AppService
    Controller --> User: Error Code
    deactivate Controller
else Valid Session Update

AppService -> Repository: findSessionById
activate Repository
Repository --> AppService: session
deactivate Repository

AppService -> session: reschedule(newScheduledAt, newScheduledEndAt, Clock)
activate SessionDomain

note right of SessionDomain
  Clock을 사용하여 Asia/Seoul 시간대 기준으로
  24시간 미만 지속시간 검증 수행
end note

session -> Clock: getZone(), instant()
activate Clock
Clock --> session: Asia/Seoul 시간대 정보
deactivate Clock

deactivate SessionDomain

AppService -> session: changeInfo(newTitle, newType, Clock)
activate SessionDomain
session -> Clock: instant()
activate Clock
Clock --> session: 현재 시각
deactivate Clock
deactivate SessionDomain

AppService -> session: changeLocation(newLocation, newLocationDetails, Clock)
activate SessionDomain
session -> Clock: instant()
activate Clock
Clock --> session: 현재 시각
deactivate Clock
deactivate SessionDomain

AppService -> Repository: save
activate Repository
deactivate Repository

AppService --> Controller: void
deactivate AppService

Controller --> User: 204 No Content
deactivate Controller

end

@enduml