@startuml

title 1.3 [P1] Password Reset - (1) 패스워드 재설정 요청

actor "User (Guest)" as User
participant "MemberPasswordController" as Controller
participant "PasswordResetService" as AppService
participant "MemberQueryRepository" as QueryRepository
participant "PasswordResetTokenProvider" as TokenProvider
participant "EmailTaskExecutor" as TaskExecutor
participant "EmailSender" as EmailAdapter

User -> Controller: POST /api/v1/members/reset-password\n{email: "user@example.com"}
activate Controller

Controller -> AppService: requestReset(request)
activate AppService

AppService -> QueryRepository: findByEmail(email)
activate QueryRepository
alt Email Not Found
    QueryRepository --> AppService: Optional.empty()
    deactivate QueryRepository
    AppService --> Controller: DomainException (PASSWORD_RESET_EMAIL_NOT_FOUND)
    deactivate AppService
    Controller --> User: 400 Bad Request
    deactivate Controller
else Email Found
    QueryRepository --> AppService: Optional<Member>
    deactivate QueryRepository

    AppService -> TokenProvider: createResetToken(email)
    activate TokenProvider
    TokenProvider --> AppService: token
    deactivate TokenProvider

    AppService -> TaskExecutor: execute(Runnable)
    activate TaskExecutor
    TaskExecutor -> EmailAdapter: sendPasswordResetEmail(email, token)
    activate EmailAdapter
    note right: 재설정 링크:\n/api/v1/members/reset-password?token=xxx
    EmailAdapter --> TaskExecutor
    deactivate EmailAdapter
    deactivate TaskExecutor

    AppService --> Controller: RequestResetResponse
    deactivate AppService

    Controller --> User: 200 OK
    deactivate Controller
end
@enduml