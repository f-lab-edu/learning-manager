@startuml

title 3.4 [P2] Session Deletion

actor "User (Manager/Admin)" as User
participant "SessionController" as Controller
participant "SessionDeletionService" as AppService
participant "SessionQueryRepository" as QueryRepo
participant "SessionCommandRepository" as CommandRepo

User -> Controller: DELETE /api/v1/sessions/{sessionId}
activate Controller

Controller -> AppService: deleteSession(sessionId)
activate AppService

AppService -> QueryRepo: findById(sessionId)
activate QueryRepo
alt Session Not Found
    QueryRepo --> AppService: Optional.empty()
    deactivate QueryRepo
    AppService --> Controller: DomainException (SESSION_NOT_FOUND)
    deactivate AppService
    Controller --> User: 400 Bad Request
    deactivate Controller
else Session Found
    QueryRepo --> AppService: session
    deactivate QueryRepo

    note right of AppService
      - Validate user has permission (is Admin or Course Manager)
      - Validate session has no children
    end note

    AppService -> CommandRepo: delete(session)
    activate CommandRepo
    deactivate CommandRepo

    AppService --> Controller: void
    deactivate AppService

    Controller --> User: 204 No Content
    deactivate Controller
end

@enduml
