@startuml

title 2.6 [P1] Curriculum Creation : 커리큘럼 생성

actor "User (Manager)" as User
participant "JwtAuthenticationFilter" as Filter
participant "CourseCurriculumAdditionController" as Controller
participant "CurriculumCreationService" as AppService
participant "CourseQueryRepository" as QueryRepo
participant "Course" as CourseDomain
participant "CourseCommandRepository" as CommandRepo

User -> Controller: POST /api/v1/courses/{courseId}/curriculums
note left: with Authorization header
activate Controller

Controller -> AppService: createCurriculum(courseId, request)
activate AppService

AppService -> QueryRepo: findManagedCourseById(courseId, managerId)
note left: managerId from AuthenticationContextHolder
activate QueryRepo
alt Not a Manager
    QueryRepo --> AppService: Optional.empty()
    deactivate QueryRepo
    AppService --> Controller: AuthorizationException
    deactivate AppService
    Controller --> User: 403 Forbidden
    deactivate Controller
else Is a Manager
    QueryRepo --> AppService: course
    deactivate QueryRepo

    AppService -> CourseDomain: addCurriculum(title, description)
    activate CourseDomain
    deactivate CourseDomain

    AppService -> CommandRepo: save(course)
    activate CommandRepo
    deactivate CommandRepo

    AppService --> Controller: CurriculumCreation.Response
    deactivate AppService

    Controller --> User: 201 Created
    deactivate Controller
end

@enduml
