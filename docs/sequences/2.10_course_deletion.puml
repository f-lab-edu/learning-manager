@startuml

title 2.10 [P2] Course Deletion : 스터디 과정 삭제

actor "User (Manager)" as User
participant "JwtAuthenticationFilter" as Filter
participant "CourseDeletionController" as Controller
participant "CourseDeletionService" as AppService
participant "CourseQueryRepository" as QueryRepo
participant "CourseCommandRepository" as CommandRepo

User -> Controller: DELETE /api/v1/courses/{courseId}
note left: with Authorization header
activate Controller

Controller -> AppService: deleteCourse(courseId)
activate AppService

AppService -> QueryRepo: findManagedCourseById(courseId, managerId)
activate QueryRepo
alt Not a Manager
    QueryRepo --> AppService: Optional.empty()
    deactivate QueryRepo
    AppService --> Controller: AuthorizationException
    deactivate AppService
    Controller --> User: 403 Forbidden
    deactivate Controller
else Is a Manager
    QueryRepo --> AppService: course
    deactivate QueryRepo

    AppService -> CommandRepo: delete(course)
    activate CommandRepo
    note right: CourseMember, Curriculum 등\n연관 엔티티는 orphanRemoval=true\n또는 DB CASCADE에 의해 함께 삭제됨
    deactivate CommandRepo

    AppService --> Controller: void
    deactivate AppService

    Controller --> User: 204 No Content
    deactivate Controller
end

@enduml
