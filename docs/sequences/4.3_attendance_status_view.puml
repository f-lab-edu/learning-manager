@startuml

title 4.3 [P1] Attendance Status View

actor "User (Member)" as User
participant "AttendanceController" as Controller
participant "AttendanceRetrievalService" as AppService
participant "SessionQueryRepository" as SessionQueryRepo
participant "AttendanceQueryRepository" as AttendQueryRepo

== 전체 출석 현황 조회 ==

User -> Controller: GET /api/v1/attendance/status/my
activate Controller

Controller -> AppService: getMyAllAttendanceStatus(request)
activate AppService

AppService -> SessionQueryRepo: findSessionIdsByMemberId(memberId)
activate SessionQueryRepo
SessionQueryRepo --> AppService: sessionIds
deactivate SessionQueryRepo

AppService -> AttendQueryRepo: findAttendanceProjectionByMemberIdAndSessionIds(...)
activate AttendQueryRepo
AttendQueryRepo --> AppService: attendances
deactivate AttendQueryRepo

AppService -> SessionQueryRepo: findSessionInfoMapByIds(sessionIds)
activate SessionQueryRepo
SessionQueryRepo --> AppService: sessionInfoMap
deactivate SessionQueryRepo

note right of AppService
  AttendanceStatistics 계산:
  - 총 세션 수
  - 출석/지각/조퇴/결석 횟수
  - 출석률(%)
end note

AppService --> Controller: Response(sessionInfos, statistics)
deactivate AppService

Controller --> User: 200 OK (attendanceStatus)
deactivate Controller

== 기타 조회 엔드포인트 ==

note over User, AttendQueryRepo
  **과정별 조회**: GET /api/v1/attendance/status/my/course?courseId=...
  **커리큘럼별 조회**: GET /api/v1/attendance/status/my/curriculum?curriculumId=...
  **월별 조회**: GET /api/v1/attendance/status/my/monthly?year=2025&month=12
  **기간별 조회**: GET /api/v1/attendance/status/my/period?startDate=...&endDate=...

  모든 조회는 동일한 흐름:
  1. SessionQueryRepository에서 세션 ID 목록 조회
  2. AttendanceQueryRepository에서 출석 기록 조회
  3. SessionQueryRepository에서 세션 정보 조회
  4. 통계 계산 후 응답 반환
end note

@enduml
