@startuml

title 2.9 [P2] Curriculum Deletion : 스터디 커리큘럼 삭제

actor "User (Manager)" as User
participant "JwtAuthenticationFilter" as Filter
participant "CurriculumDeletionController" as Controller
participant "CurriculumDeletionService" as AppService
participant "CourseQueryRepository" as QueryRepo
participant "Course" as CourseDomain
participant "CourseCommandRepository" as CommandRepo

User -> Controller: DELETE /api/v1/courses/{courseId}/curriculums/{curriculumId}
note left: with Authorization header
activate Controller

Controller -> AppService: deleteCurriculum(courseId, curriculumId)
activate AppService

AppService -> QueryRepo: findManagedCourseById(courseId, managerId)
activate QueryRepo
alt Not a Manager
    QueryRepo --> AppService: Optional.empty()
    deactivate QueryRepo
    AppService --> Controller: AuthorizationException
    deactivate AppService
    Controller --> User: 403 Forbidden
    deactivate Controller
else Is a Manager
    QueryRepo --> AppService: course
    deactivate QueryRepo

    AppService -> CourseDomain: findCurriculumById(curriculumId)
    activate CourseDomain
    deactivate CourseDomain

    AppService -> CourseDomain: removeCurriculum(curriculum)
    activate CourseDomain
    deactivate CourseDomain

    AppService -> CommandRepo: save(course)
    activate CommandRepo
    deactivate CommandRepo

    AppService --> Controller: void
    deactivate AppService

    Controller --> User: 204 No Content
    deactivate Controller
end

@enduml
