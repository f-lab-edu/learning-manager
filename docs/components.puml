@startuml
title "LM Component Diagram v0.0.7 (Multi-Module Architecture)"
skinparam componentStyle rectangle

skinparam {
    shadowing false
    packageStyle rectangle
    componentBackgroundColor White
    componentBorderColor #666666
    packageBorderColor #999999
    arrowColor #666666
}

' ========================================
' Infrastructure Layer
' ========================================
package "Infrastructure" as Infra #E8E8E8 {
    component "Client" as Client
    database "MySQL" as MySQL
    database "MongoDB" as MongoDB
    database "H2 (Test)" as H2
    component "SMTP Server" as SMTP
}

' ========================================
' App Module (app/api)
' ========================================
package "app" #DDEEFF {
    package "api" {
        component "Controllers" as Controllers
        component "Security Config" as Security
    }
}

' ========================================
' Adapter Module
' ========================================
package "adapter" #FFE4C4 {
    package "persistence" {
        component "JPA Repositories" as JpaRepo
        component "Entity Mappers" as EntityMapper
    }

    package "mongo" {
        component "Mongo Repositories" as MongoRepo
        component "Document Mappers" as DocMapper
    }

    package "infra" {
        component "JWT Provider" as JwtProviderImpl
        component "Password Encoder" as PwEncoderImpl
        component "Email Sender" as EmailSenderImpl
    }
}

' ========================================
' Core Module (Hexagonal Architecture)
' ========================================
package "core" #E0FFE0 {
    package "provides (Inbound Ports)" {
        interface "UseCases" as UseCases
    }

    package "service" {
        component "Application Services" as AppServices
    }

    package "requires (Outbound Ports)" {
        interface "Repositories" as Repositories
        interface "External Services" as ExtServices
    }

    package "domain" {
        component "Member" as DomainMember
        component "Course" as DomainCourse
        component "Session" as DomainSession
        component "Attendance" as DomainAttendance
        component "Auth" as DomainAuth
    }
}

' ========================================
' Support Module
' ========================================
package "support" #F0E68C {
    component "Logging" as Logging
    component "Monitoring" as Monitoring
}

' ========================================
' Dependency Flow
' ========================================

' Client -> App
Client --> Controllers : HTTP Request

' App -> Core (Inbound)
Controllers ..> UseCases : uses
Security ..> UseCases : authenticates

' Core Service implements Use Cases
AppServices .up.|> UseCases : implements

' Core Service -> Outbound Ports
AppServices ..> Repositories : uses
AppServices ..> ExtServices : uses

' Core Service -> Domain
AppServices --> DomainMember
AppServices --> DomainCourse
AppServices --> DomainSession
AppServices --> DomainAttendance
AppServices --> DomainAuth

' Adapter implements Outbound Ports
JpaRepo .up.|> Repositories : implements
MongoRepo .up.|> Repositories : implements
JwtProviderImpl .up.|> ExtServices : implements
PwEncoderImpl .up.|> ExtServices : implements
EmailSenderImpl .up.|> ExtServices : implements

' Adapter -> Infrastructure
JpaRepo --> MySQL : prod
JpaRepo --> H2 : test
MongoRepo --> MongoDB
EmailSenderImpl --> SMTP

' Support (cross-cutting)
Controllers ..> Logging
AppServices ..> Logging

' ========================================
' Legend
' ========================================
legend right
  |= Color |= Module |
  | <#DDEEFF> | app (Entry Point) |
  | <#E0FFE0> | core (Business Logic) |
  | <#FFE4C4> | adapter (External Interface) |
  | <#F0E68C> | support (Cross-cutting) |
  | <#E8E8E8> | infrastructure (External) |
end legend

@enduml
